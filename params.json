{"name":"Django Sortable","body":"Like pagination in Django, django-sortable works on a variety of data-types. When possible, an `order_by` clause will be added to a QuerySet. However, django-sortable can also handle lists of dictionaries or objects. Support is available for raw queries as well.\r\n\r\n\r\n## Installation\r\n\r\n1.  Add django-sortable to the `INSTALLED_APPS` setting in your project's settings.py file:\r\n\r\n        INSTALLED_APPS = (\r\n            # …\r\n            'django_sortable',\r\n        )\r\n\r\n2.  Add the request context processor to the `TEMPLATE_CONTEXT_PROCESSORS` setting. If you don't have these defined in your settings.py file, you'll have to specify the default ones, and add the request processor at the end. (The current defaults are listed in the Django [context processor documentation](https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-TEMPLATE_CONTEXT_PROCESSORS).) This setting will look something like this:\r\n\r\n        TEMPLATE_CONTEXT_PROCESSORS = (\r\n            'django.contrib.auth.context_processors.auth',\r\n            'django.core.context_processors.debug',\r\n            'django.core.context_processors.i18n',\r\n            'django.core.context_processors.media',\r\n            'django.core.context_processors.static',\r\n            'django.contrib.messages.context_processors.messages',\r\n\t\t    \r\n            # this is the additional requirement… \r\n            'django.core.context_processors.request', \r\n        )\r\n\r\n\r\n## Basic Usage\r\n\r\nThe most basic way to use django-sortable is to pass a QuerySet to the sortable helper, and add some simple template tags. Here's an example view and template:\r\n\r\n__views.py__\r\n\r\n        from django_sortable.helpers import sortable_helper\r\n\t\r\n        def books(request):\r\n            book_list = Book.objects.all()\r\n            books = sortable_helper(request, book_list)\r\n\t    \r\n            # pagination code would go here, after sorting\r\n            # …\r\n\t    \r\n            return render_to_response('books.html', {'books': books})\r\n\r\n__books.html__\r\n\r\n        {% load sortable %}\r\n\t\r\n        <table>\r\n            <tr>\r\n                {% sortable_header title %}\r\n                {% sortable_header published %}\r\n            </tr>\r\n            {% for book in books %}\r\n            <tr>\r\n                <td>{{ book.title }}</td>\r\n                <td>{{ book.published }}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n\r\n\r\n## Advanced Usage\r\n\r\nIf you need more control over the behavior of django-sortable, you can use the Sortable class directly. Here's how you'd do it:\r\n\r\n__views.py__\r\n\r\n        from django_sortable.sortable import Sortable\r\n\t\r\n        def authors(request):\r\n\t\t\r\n            # we can pass in a list (or tuple) of dictionaries too!\r\n            author_list = Author.objects.values()\r\n\t\t\r\n            sortable = Sortable(author_list, (('author', 'full_name'), 'birth_date'))\r\n            field_name = request.GET.get('sort', '')\r\n            direction = request.GET.get('dir', 'asc')\r\n            authors = sortable.sorted(field_name, direction)\r\n\t\t\r\n            # pagination code would go here, after sorting\r\n            # …\r\n\t\t\r\n            return render_to_response('authors.html', {'authors': authors})\r\n\r\n__authors.html__\r\n\r\n        {% load sortable %}\r\n\t\r\n        <table>\r\n            <tr>\r\n                <th>{% sortable_link author %}</th>\r\n                <th>{% sortable_link birth_date \"Birthday\" %}</th>\r\n            </tr>\r\n            {% for author in authors %}\r\n            <tr>\r\n                <td>{{ author.full_name }}</td>\r\n                <td>{{ author.birth_date }}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n\r\n\r\n## Raw SQL Usage\r\n\r\nYou can use django-sortable with raw queries by asking for just ordering columns. This way you can build the query yourself and append an ORDER BY clause. Here's an example:\r\n\r\n__views.py__\r\n\r\n        from django_sortable.sortable import Sortable\r\n\t\r\n        def books(request):\r\n\t\t\r\n            # all we need is an ordering column, don't pass an object list\r\n            sortable = Sortable(None, (('book', 'b.title'),))\r\n            field_name = request.GET.get('sort', '')\r\n            direction = request.GET.get('dir', 'asc')\r\n\t\t\r\n            # also, you can pass in a default ordering column(s)\r\n            order_col = sortable.sql_column(\r\n                field_name=field_name, \r\n                direction=direction, \r\n                default='m.title ASC, p.title ASC, t.condition DESC'\r\n            )\r\n\t\r\n            sql = '''\r\n                SELECT      \r\n                    b.id AS id,\r\n                    b.title AS title,\r\n                    b.page_count AS num_pages,\r\n                    a.full_name AS author,\r\n                FROM \r\n                    book as b, \r\n                    author as a\r\n                WHERE \r\n                    b.page_count > 100 AND\r\n                    b.status = %s AND\r\n                    b.author_id = a.id\r\n                ORDER BY ''' + order_col\r\n\t\t\t\r\n                cursor = connection.cursor()\r\n                cursor.execute(sql, ['available',])\r\n                books = dictfetchall(cursor)\r\n\t\t\r\n                return render_to_response('books.html', {'books': books})\r\n\r\n\r\n__books.html__\r\n\r\n        {% load sortable %}\r\n\t\r\n        <table>\r\n            <tr>\r\n                <th>{% sortable_link book \"Book\" %}</th>\r\n                <th>Author</th>\r\n            </tr>\r\n            {% for book in books %}\r\n            <tr>\r\n                <td>{{ book.title }}</td>\r\n                <td>{{ book.author }}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n\r\n\r\n## Additional Options\r\n\r\n#### Defining Ordering Fields\r\n\r\nSometimes the column you sort by is complex; especially if it spans relationships. You can specify sortable fields with custom order fields very easily. Imagine that we want to sort by author in our basic books example. We need to specify ordering fields for all the fields we want to order by, and add an additional string for a special ordering field:\r\n\r\n        books = sortable_helper(\r\n            request=request, \r\n            objects=book_list, \r\n            fields=('title', 'published', ('author', 'author__fullname'), 'page_count')\r\n        )\r\n\r\nNotice that we have a tuple for the fields argument, and one of the items in the tuple is another tuple. In this inner tuple, the first item is the __field name__ and the second is our special __ordering field__. When we sort on _author_, we're actually sorting on _author__fullname_.\r\n\r\nDefining ordering fields has the secondary benefit of locking down which fields are sorted on.\r\n\r\n\r\n#### Rendering Links\r\n\r\nIf you want to specify a title in the header or link, you can place it in the `sortable_header` itself. Do it like this:\r\n\t\r\n        {% sortable_header page_count \"Number of Pages\" %}\r\n\t\r\nThis tag generates a table header like this:\r\n\r\n        <th class=\"sort-asc\"><a href=\"/books/?sort=page_count&dir=asc\" title=\"Number of Pages\">Number of Pages</a></th>\r\n\r\nYou may want to do this to obscure your field names, but most commonly you probably just want to specify some easier-to-read text. If you don't want to use table headers, you can get plain links with the `sortable_link` tag like this:\r\n\r\n        {% sortable_link page_count \"Number of Pages\" %}\r\n\r\nThis tag will generate a link with a class on the anchor instead of the table header:\r\n\r\n        <a class=\"sort-asc\" href=\"/books/?sort=page_count&dir=asc\" title=\"Number of Pages\">Number of Pages</a>\r\n\r\n\r\n#### Setting Custom Classes\r\n\r\nDepending on the direction of the sort, a class will be placed on each header or link. The default classes are `sort-asc`, `sort-desc`, and `sort-none`. However, these are fully customizable using your project's settings. In your settings.py file, set these variables:\r\n\r\n        SORT_ASC_CLASS = 'sort-asc'\r\n        SORT_DESC_CLASS = 'sort-desc'\r\n        SORT_NONE_CLASS = 'sort-none'\r\n\r\n\r\n#### Building Arbitrary Sort Links\r\n\r\nIf your template code is really gnarly, you can build your own sorting links using some special template tags. This method isn't recommended as a common practice, but you can use this feature to handle special cases.\r\n\r\nSay you want to have a column header link with this markup:\r\n\r\n        <th colspan=\"2\" class=\"my-header sort-asc\">\r\n            <a href=\"/\" title=\"Book\">\r\n                <span class=\"book-icon\">Book</span>\r\n            </a>\r\n        </th>\r\n\r\nObviously neither the `sortable_header` or `sortable_link` tags will work here, but we can build this by hand using the `sortable_class` and `sortable_url` tags.  \r\n\r\n        <th colspan=\"2\" class=\"my-header {% sortable_class book %}\">\r\n            <a href=\"{% sortable_url book %}\" title=\"Book\">\r\n                <span class=\"book-icon\">Book</span>\r\n            </a>\r\n        </th>\r\n\r\nThere is a slight maintenance burden here because you'll have to remember to change both the `sortable_class` and `sortable_url` tags if you want to adjust the sort column.","tagline":"A better, more flexible way to handle sorting within a complex Django application.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}